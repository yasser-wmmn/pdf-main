<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <title>ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª Ø¥Ù„Ù‰ Word - Ù†Ø³Ø®Ø© Ø§Ù„ÙˆÙŠØ¨</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="favicon.ico">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&family=Tajawal:wght@400;500;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <!-- Ù…ÙƒØªØ¨Ø§Øª Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© (Client-Side) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
    <script src="https://unpkg.com/docx@7.8.2/build/index.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div class="side-shape shape1"></div>
    <div class="side-shape shape2"></div>
    <div class="side-shape shape3"></div>
    <div class="side-shape shape4"></div>
    <div class="side-shape shape5"></div>

    <div class="header-logo"></div>

    <div class="upload-container">
        <h2>ğŸ”„ ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª Ø¥Ù„Ù‰ Word</h2>
        <p>ÙŠØ¹Ù…Ù„ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ ÙÙŠ Ù…ØªØµÙØ­Ùƒ! Ù„Ø§ ÙŠØªÙ… Ø±ÙØ¹ Ù…Ù„ÙØ§ØªÙƒ Ù„Ø£ÙŠ Ø®Ø§Ø¯Ù…. ğŸ”’</p>

        <label for="file_input" class="custom-file-upload">
            <i class="fas fa-cloud-upload-alt upload-icon"></i>
            <strong>Ø§Ù†Ù‚Ø± Ù„Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù</strong>
            <small style="display: block; margin-top: 8px; opacity: 0.7;">PDF Ø£Ùˆ ØµÙˆØ±Ø© (JPG, PNG, WebP)</small>
            <input id="file_input" type="file" accept=".pdf,.jpg,.jpeg,.png,.webp" style="display:none">
            <span id="file-name"></span>
        </label>

        <button id="convert-btn" disabled>
            <i class="fas fa-magic" style="margin-left: 8px;"></i>
            Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­ÙˆÙŠÙ„
        </button>

        <div class="progress-container" id="progress-container">
            <div class="progress-bar-bg">
                <div class="progress-bar-fill" id="progress-fill"></div>
            </div>
            <div class="status-text" id="status-text">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
        </div>

        <div class="success-area" id="success-area">
            <p>âœ… ØªÙ… Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­!</p>
            <button id="download-btn" style="background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);">
                <i class="fas fa-download" style="margin-left: 8px;"></i>
                ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù Word
            </button>
        </div>

        <div class="note">
            ğŸ’¡ <strong>Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</strong><br>
            â€¢ ÙŠØ¯Ø¹Ù… Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© ÙˆØ§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©<br>
            â€¢ Ø³Ø±Ø¹Ø© Ø§Ù„ØªØ­ÙˆÙŠÙ„ ØªØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ Ø³Ø±Ø¹Ø© Ø¬Ù‡Ø§Ø²Ùƒ (Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ù…Ø­Ù„ÙŠØ© 100%)
        </div>
    </div>

    <script>
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª
        window.addEventListener('load', function () {
            if (typeof pdfjsLib === 'undefined') {
                alert('âš ï¸ Ø®Ø·Ø£: Ù„Ù… ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ù…ÙƒØªØ¨Ø© PDF.js. ØªØ­Ù‚Ù‚ Ù…Ù† Ø§ØªØµØ§Ù„Ùƒ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª.');
            }
            if (typeof Tesseract === 'undefined') {
                alert('âš ï¸ Ø®Ø·Ø£: Ù„Ù… ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ù…ÙƒØªØ¨Ø© Tesseract.js. ØªØ­Ù‚Ù‚ Ù…Ù† Ø§ØªØµØ§Ù„Ùƒ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª.');
            }
            if (typeof docx === 'undefined') {
                console.error('âš ï¸ Ø®Ø·Ø£: Ù„Ù… ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ù…ÙƒØªØ¨Ø© docx. ØªØ­Ù‚Ù‚ Ù…Ù† Ø§ØªØµØ§Ù„Ùƒ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª.');
                alert('âš ï¸ Ø®Ø·Ø£: Ù„Ù… ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ù…ÙƒØªØ¨Ø© docx. ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø© Ø£Ùˆ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§ØªØµØ§Ù„Ùƒ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª.');
            }
            if (typeof saveAs === 'undefined') {
                alert('âš ï¸ Ø®Ø·Ø£: Ù„Ù… ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ù…ÙƒØªØ¨Ø© FileSaver.js. ØªØ­Ù‚Ù‚ Ù…Ù† Ø§ØªØµØ§Ù„Ùƒ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª.');
            }
        });

        // Ø¥Ø¹Ø¯Ø§Ø¯ PDF.js Worker
        if (typeof pdfjsLib !== 'undefined') {
            pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
        }

        const fileInput = document.getElementById('file_input');
        const fileNameSpan = document.getElementById('file-name');
        const convertBtn = document.getElementById('convert-btn');
        const progressContainer = document.getElementById('progress-container');
        const progressFill = document.getElementById('progress-fill');
        const statusText = document.getElementById('status-text');
        const successArea = document.getElementById('success-area');
        const downloadBtn = document.getElementById('download-btn');

        let selectedFile = null;
        let generatedDocBlob = null;

        fileInput.addEventListener('change', (e) => {
            if (e.target.files && e.target.files[0]) {
                selectedFile = e.target.files[0];
                fileNameSpan.textContent = selectedFile.name;
                convertBtn.disabled = false;
                successArea.style.display = 'none';
            }
        });

        convertBtn.addEventListener('click', async () => {
            if (!selectedFile) return;

            convertBtn.disabled = true;
            convertBtn.style.opacity = '0.5';
            progressContainer.style.display = 'block';
            successArea.style.display = 'none';
            updateProgress(0, "Ø¬Ø§Ø±ÙŠ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù…Ø­Ø±Ùƒ...");

            try {
                let textPages = [];

                if (selectedFile.type === 'application/pdf') {
                    textPages = await processPDF(selectedFile);
                } else if (selectedFile.type.startsWith('image/')) {
                    textPages = await processImage(selectedFile);
                } else {
                    alert('Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…');
                    resetUI();
                    return;
                }

                updateProgress(90, "Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù Word...");
                generatedDocBlob = await createWordDoc(textPages);

                updateProgress(100, "ØªÙ… Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡!");
                successArea.style.display = 'block';

                // ØªØ­Ù…ÙŠÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø£Ùˆ ÙŠØ¯ÙˆÙŠ
                downloadBtn.onclick = () => {
                    saveAs(generatedDocBlob, `converted_${selectedFile.name.split('.')[0]}.docx`);
                };

            } catch (err) {
                console.error(err);
                alert(`Ø­Ø¯Ø« Ø®Ø·Ø£: ${err.message}`);
            } finally {
                convertBtn.disabled = false;
                convertBtn.style.opacity = '1';
            }
        });

        function resetUI() {
            convertBtn.disabled = false;
            convertBtn.style.opacity = '1';
            progressContainer.style.display = 'none';
        }

        function updateProgress(percent, text) {
            progressFill.style.width = `${percent}%`;
            statusText.textContent = text;
        }

        async function processImage(file) {
            updateProgress(20, "Ø¬Ø§Ø±ÙŠ ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø© (OCR)...");
            const text = await performOCR(file);
            return [{ text: text }];
        }

        async function processPDF(file) {
            const arrayBuffer = await file.arrayBuffer();
            const pdf = await pdfjsLib.getDocument(arrayBuffer).promise;
            const totalPages = pdf.numPages;
            let pagesContent = [];

            for (let i = 1; i <= totalPages; i++) {
                updateProgress(Math.round((i / totalPages) * 80), `Ø¬Ø§Ø±Ù Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØµÙØ­Ø© ${i} Ù…Ù† ${totalPages}...`);

                const page = await pdf.getPage(i);
                const viewport = page.getViewport({ scale: 2.0 }); // Ø¯Ù‚Ø© Ø¹Ø§Ù„ÙŠØ© Ù„Ù„ØªØ¹Ø±Ù Ø§Ù„Ø£ÙØ¶Ù„
                const canvas = document.createElement('canvas');
                const context = canvas.getContext('2d');
                canvas.height = viewport.height;
                canvas.width = viewport.width;

                await page.render({ canvasContext: context, viewport: viewport }).promise;

                // ØªØ­ÙˆÙŠÙ„ Ø§Ù„ÙƒØ§Ù†ÙØ§Ø³ Ù„ØµÙˆØ±Ø© Ù„Ù„Ù€ OCR
                const blob = await new Promise(resolve => canvas.toBlob(resolve, 'image/png'));
                const text = await performOCR(blob);

                pagesContent.push({ text: text });
            }
            return pagesContent;
        }

        async function performOCR(imageBlob) {
            // Ø§Ø³ØªØ®Ø¯Ø§Ù… Tesseract.js
            const worker = await Tesseract.createWorker('ara+eng');

            // ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© ÙˆØ§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©
            await worker.setParameters({
                tessedit_pageseg_mode: Tesseract.PSM.AUTO,
            });

            const ret = await worker.recognize(imageBlob);
            await worker.terminate();
            return ret.data.text;
        }

        async function createWordDoc(pages) {
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªÙˆÙØ± Ù…ÙƒØªØ¨Ø© docx Ø¨Ø·Ø±Ù‚ Ù…Ø®ØªÙ„ÙØ©
            const docxLib = window.docx || (typeof docx !== 'undefined' ? docx : null);

            if (!docxLib) {
                throw new Error('Ù…ÙƒØªØ¨Ø© docx ØºÙŠØ± Ù…ØªÙˆÙØ±Ø©. ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø©.');
            }

            const { Document, Packer, Paragraph, TextRun, AlignmentType, HeadingLevel } = docxLib;

            const docChildren = [];

            // Ø¹Ù†ÙˆØ§Ù†
            docChildren.push(
                new Paragraph({
                    text: selectedFile.name,
                    heading: HeadingLevel.HEADING_1,
                    alignment: AlignmentType.CENTER,
                    bidirectional: true // Ù…Ù‡Ù… Ù„Ù„Ø¹Ø±Ø¨ÙŠØ©
                })
            );

            pages.forEach((page, index) => {
                if (index > 0) {
                    // ÙØ§ØµÙ„ ØµÙØ­Ø§Øª
                    docChildren.push(new Paragraph({
                        text: "â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•",
                        alignment: AlignmentType.CENTER
                    }));
                }

                const lines = page.text.split('\n');
                lines.forEach(line => {
                    const cleanLine = line.trim();
                    if (cleanLine) {
                        docChildren.push(
                            new Paragraph({
                                children: [
                                    new TextRun({
                                        text: cleanLine,
                                        size: 24, // 12pt
                                        font: "Arial",
                                        rightToLeft: true // ØªÙØ¹ÙŠÙ„ Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ù†Øµ
                                    })
                                ],
                                bidirectional: true, // ØªÙØ¹ÙŠÙ„ Ø§ØªØ¬Ø§Ù‡ Ø§Ù„ÙÙ‚Ø±Ø©
                                alignment: AlignmentType.RIGHT // Ù…Ø­Ø§Ø°Ø§Ø© Ù„Ù„ÙŠÙ…ÙŠÙ† Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹
                            })
                        );
                    }
                });
            });

            const doc = new Document({
                sections: [{
                    properties: {},
                    children: docChildren,
                }],
            });

            return await Packer.toBlob(doc);
        }
    </script>
</body>

</html>